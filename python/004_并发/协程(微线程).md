# 协程(微线程)

- 子程序: 线程中的函数
- 线程是系统级别的它们由操作系统调度，而协程则是程序级别的由程序根据需要自己调度。
- 在同一线程内一段代码在执行过程中会中断然后跳转执行别的代码，接着在之前中断的地方继续开始执行, 这个过程称为携程，类似yield操作。
- 协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈。因此：协程能保留上一次调用时的状态（即所有局部状态的一个特定组合），每次过程重入时，就相当于进入上一次调用的状态，换种说法：进入上一次离开时所处逻辑流的位置。
- 协程的优点：
   - 无需线程上下文切换的开销，协程避免了无意义的调度，由此可以提高性能，协程的调度完全由用户控制，发生在用户空间而非内核空间，因此切换的代价非常的小。
   - 无需原子操作锁定及同步的开销
   - 方便切换控制流，简化编程模型
   - 高并发+高扩展性+低成本：一个CPU支持上万的协程都不是问题。所以很适合用于高并发处理。
   - 一个线程可以有多个协程，当任务被堵塞的时候执行下一个任务，当恢复的时候再回来执行这个任务，任务之间的切换只需要保存每个任务的上下文内容, 这样就完全没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快
- 协程的缺点:
   - 无法利用多核资源：协程的本质是个单线程,它不能同时将 单个CPU 的多个核用上,协程需要和进程配合才能运行在多CPU上。

